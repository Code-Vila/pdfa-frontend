import{d as K,e as Q,r as d,m as W,f as X,p as Y,g as Z,c as r,o as l,a as e,h as v,q as x,v as z,s as S,t as a,b as ee,j as A,l as q,k as h,F as te,i as se,n as P}from"./index-DLa-AQ1v.js";import{p as oe}from"./pdf-conversion-C9XHmFt4.js";import"./api-instances-DsKvZEhO.js";const ae={class:"min-h-screen bg-gray-900"},re={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},le={class:"card mb-6"},ne={class:"card-body"},ie={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},de={class:"mt-4 flex gap-4"},ue={key:0,class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},ce={class:"card"},me={class:"card-body text-center"},ge={class:"text-2xl font-bold text-primary-400"},ve={class:"card"},pe={class:"card-body text-center"},ye={class:"text-2xl font-bold text-green-400"},xe={class:"card"},fe={class:"card-body text-center"},be={class:"text-2xl font-bold text-red-400"},_e={class:"card"},he={class:"card-body text-center"},we={class:"text-2xl font-bold text-yellow-400"},ke={key:1,class:"card"},Ce={key:2,class:"card"},Ve={class:"card-body"},Me={class:"text-center py-12"},Te={class:"text-gray-500 mb-4"},ze={key:3,class:"card"},Se={class:"card-body"},Be={class:"text-center py-12"},Fe={key:4,class:"space-y-4"},De={class:"card-body"},He={class:"flex items-center justify-between"},Ee={class:"flex items-center space-x-4"},Le={class:"flex-1 min-w-0"},Ne={class:"text-lg font-medium text-gray-100"},Ae={class:"mt-1 flex items-center space-x-4 text-sm text-gray-500"},qe={class:"flex items-center"},Pe={key:0},Ue={key:1},Ie={class:"mt-1 text-sm text-gray-500"},je={key:0,class:"mt-1 text-sm text-red-400"},Oe={class:"flex-shrink-0"},Re={class:"flex-shrink-0 flex items-center space-x-2"},$e=["onClick"],Ge=["disabled"],Je={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ke={class:"text-sm text-gray-500 mt-2"},Qe={key:1,class:"text-center py-8"},We={class:"text-sm text-gray-600 mt-1"},Xe={class:"mt-8 text-center"},ot=K({__name:"History",setup(Ye){const w=Q(),p=d([]),y=d(null),u=d(null),k=d(!0),c=d(!1),f=d(null),C=d(1),V=d(null),n=d({page:1,per_page:10,status:void 0,filename:"",date_from:"",date_to:"",order_by:"created_at",order_direction:"desc"}),U=()=>new Date().toISOString().split("T")[0],B=()=>{const o=U();n.value={page:1,per_page:10,status:void 0,filename:"",date_from:o,date_to:o,order_by:"created_at",order_direction:"desc"}},M=W(()=>u.value?u.value.current_page<u.value.last_page:!1);let T=null;const I=()=>{T&&clearTimeout(T),T=setTimeout(()=>{m()},500)};let b=null;const j=()=>{V.value&&(b=new IntersectionObserver(o=>{o[0].isIntersecting&&M.value&&!c.value&&F()},{rootMargin:"100px"}),b.observe(V.value))};X(async()=>{B(),await _(),j()}),Y(()=>{b&&b.disconnect()});const _=async(o=1)=>{o===1?(k.value=!0,p.value=[]):c.value=!0,f.value=null;try{const t={...n.value,page:o};Object.keys(t).forEach(g=>{(t[g]===""||t[g]===null||t[g]===void 0)&&delete t[g]});const i=await oe.getConversionHistory(t);i.success&&i.data?(o===1?(p.value=i.data.data,y.value=i.data.summary):p.value.push(...i.data.data),u.value=i.pagination,C.value=o):f.value=i.message||"Erro ao carregar histórico"}catch(t){f.value="Erro de conexão. Verifique sua internet e tente novamente.",console.error("Erro ao carregar histórico:",t)}finally{k.value=!1,c.value=!1}},m=()=>{C.value=1,_(1)},F=async()=>{M.value&&!c.value&&await _(C.value+1)},O=()=>{B(),m()},R=async o=>{try{if(!o.download_url){w.error("URL de download não disponível");return}const t=document.createElement("a");t.href=o.download_url,t.download=o.converted_filename||`converted_${o.id}.pdf`,document.body.appendChild(t),t.click(),document.body.removeChild(t),w.success("Download iniciado!")}catch(t){console.error("Erro no download:",t),w.error("Erro ao baixar arquivo. Tente novamente.")}},$=o=>new Date(o).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),D=o=>({processing:"Processando",completed:"Concluído",failed:"Falha"})[o]||o,G=o=>({processing:"bg-yellow-500",completed:"bg-green-500",failed:"bg-red-500"})[o]||"bg-gray-500",J=o=>({processing:"bg-yellow-100 text-yellow-800",completed:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800"})[o]||"bg-gray-100 text-gray-800";return(o,t)=>{var g,H,E;const i=Z("router-link");return l(),r("div",ae,[e("div",re,[t[34]||(t[34]=e("div",{class:"mb-8"},[e("h1",{class:"text-3xl font-bold text-gray-100"}," Histórico de Conversões "),e("p",{class:"mt-2 text-gray-400"}," Visualize e baixe suas conversões anteriores ")],-1)),e("div",le,[e("div",ne,[t[16]||(t[16]=e("h3",{class:"text-lg font-medium text-gray-100 mb-4"},"Filtros",-1)),e("div",ie,[e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Status ",-1)),x(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>n.value.status=s),onChange:m,class:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500"},[...t[7]||(t[7]=[e("option",{value:""},"Todos",-1),e("option",{value:"processing"},"Processando",-1),e("option",{value:"completed"},"Concluído",-1),e("option",{value:"failed"},"Falha",-1)])],544),[[z,n.value.status]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Nome do Arquivo ",-1)),x(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>n.value.filename=s),onInput:I,type:"text",placeholder:"Buscar por nome...",class:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500"},null,544),[[S,n.value.filename]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Data Inicial ",-1)),x(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>n.value.date_from=s),onChange:m,type:"date",class:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500"},null,544),[[S,n.value.date_from]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Data Final ",-1)),x(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>n.value.date_to=s),onChange:m,type:"date",class:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500"},null,544),[[S,n.value.date_to]])])]),e("div",de,[e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Ordenar por ",-1)),x(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>n.value.order_by=s),onChange:m,class:"px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500"},[...t[12]||(t[12]=[e("option",{value:"created_at"},"Data de Criação",-1),e("option",{value:"original_filename"},"Nome do Arquivo",-1),e("option",{value:"status"},"Status",-1),e("option",{value:"processing_time"},"Tempo de Processamento",-1)])],544),[[z,n.value.order_by]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Direção ",-1)),x(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>n.value.order_direction=s),onChange:m,class:"px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500"},[...t[14]||(t[14]=[e("option",{value:"desc"},"Decrescente",-1),e("option",{value:"asc"},"Crescente",-1)])],544),[[z,n.value.order_direction]])]),e("div",{class:"flex items-end"},[e("button",{onClick:O,class:"px-4 py-2 bg-gray-700 text-gray-300 rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500"}," Limpar Filtros ")])])])]),y.value?(l(),r("div",ue,[e("div",ce,[e("div",me,[e("div",ge,a(y.value.total_conversions),1),t[17]||(t[17]=e("div",{class:"text-sm text-gray-400"},"Total",-1))])]),e("div",ve,[e("div",pe,[e("div",ye,a(y.value.completed_conversions),1),t[18]||(t[18]=e("div",{class:"text-sm text-gray-400"},"Concluídas",-1))])]),e("div",xe,[e("div",fe,[e("div",be,a(y.value.failed_conversions),1),t[19]||(t[19]=e("div",{class:"text-sm text-gray-400"},"Falharam",-1))])]),e("div",_e,[e("div",he,[e("div",we,a(y.value.pending_conversions),1),t[20]||(t[20]=e("div",{class:"text-sm text-gray-400"},"Pendentes",-1))])])])):v("",!0),k.value?(l(),r("div",ke,[...t[21]||(t[21]=[ee('<div class="card-body"><div class="text-center py-12"><svg class="animate-spin mx-auto h-12 w-12 text-primary-600 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><p class="text-gray-400">Carregando histórico...</p></div></div>',1)])])):f.value?(l(),r("div",Ce,[e("div",Ve,[e("div",Me,[t[22]||(t[22]=e("svg",{class:"mx-auto h-12 w-12 text-red-500 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})],-1)),t[23]||(t[23]=e("h3",{class:"text-lg font-medium text-gray-100 mb-2"}," Erro ao carregar histórico ",-1)),e("p",Te,a(f.value),1),e("button",{onClick:t[6]||(t[6]=()=>_()),class:"btn-primary"}," Tentar Novamente ")])])])):p.value.length===0?(l(),r("div",ze,[e("div",Se,[e("div",Be,[t[25]||(t[25]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),t[26]||(t[26]=e("h3",{class:"text-lg font-medium text-gray-100 mb-2"}," Nenhuma conversão encontrada ",-1)),t[27]||(t[27]=e("p",{class:"text-gray-500 mb-4"}," Você ainda não converteu nenhum arquivo. ",-1)),A(i,{to:"/converter",class:"btn-primary"},{default:q(()=>[...t[24]||(t[24]=[h(" Converter Primeiro Arquivo ",-1)])]),_:1})])])])):(l(),r("div",Fe,[(l(!0),r(te,null,se(p.value,s=>{var L,N;return l(),r("div",{key:s.id,class:"card"},[e("div",De,[e("div",He,[e("div",Ee,[t[30]||(t[30]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-10 w-10 text-red-500",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z","clip-rule":"evenodd"})])],-1)),e("div",Le,[e("h3",Ne,a(s.original_filename),1),e("div",Ae,[e("span",null,a($(s.created_at)),1),t[28]||(t[28]=e("span",null,"•",-1)),e("span",qe,[e("span",{class:P([G(s.status),"inline-block w-2 h-2 rounded-full mr-2"])},null,2),h(" "+a(D(s.status)),1)]),(L=s.processing)!=null&&L.processing_time?(l(),r("span",Pe,"•")):v("",!0),(N=s.processing)!=null&&N.processing_time?(l(),r("span",Ue,a(s.processing.processing_time),1)):v("",!0)]),e("div",Ie," Tamanho: "+a(s.file_info.formatted_original_size)+" → "+a(s.file_info.formatted_converted_size||"N/A"),1),s.error_message?(l(),r("div",je," Erro: "+a(s.error_message),1)):v("",!0)]),e("div",Oe,[e("span",{class:P([J(s.status),"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},a(D(s.status)),3)]),e("div",Re,[s.status==="completed"&&s.download_url?(l(),r("button",{key:0,onClick:Ze=>R(s),class:"btn bg-primary-600 text-white hover:bg-primary-700",title:"Baixar arquivo convertido"},[...t[29]||(t[29]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)])],8,$e)):v("",!0)])])])])])}),128)),M.value?(l(),r("div",{key:0,ref_key:"loadMoreTrigger",ref:V,class:"text-center py-8"},[e("button",{onClick:F,disabled:c.value,class:"btn bg-gray-700 text-gray-300 hover:bg-gray-600 disabled:opacity-50"},[c.value?(l(),r("svg",Je,[...t[31]||(t[31]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):v("",!0),h(" "+a(c.value?"Carregando...":"Carregar Mais"),1)],8,Ge),e("p",Ke," Página "+a((g=u.value)==null?void 0:g.current_page)+" de "+a((H=u.value)==null?void 0:H.last_page),1)],512)):p.value.length>0?(l(),r("div",Qe,[t[32]||(t[32]=e("p",{class:"text-gray-500"},"Todos os resultados foram carregados",-1)),e("p",We," Total: "+a((E=u.value)==null?void 0:E.total)+" conversões ",1)])):v("",!0)])),e("div",Xe,[A(i,{to:"/",class:"btn bg-gray-700 text-gray-300 hover:bg-gray-600"},{default:q(()=>[...t[33]||(t[33]=[h(" ← Voltar para Ferramentas ",-1)])]),_:1})])])])}}});export{ot as default};
